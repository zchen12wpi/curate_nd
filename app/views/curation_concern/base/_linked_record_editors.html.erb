<fieldset id="set-record_editors">
  <% label ||= 'Record Editor' %>
  <div class="form-group required link-users" id="record_editors">
    <span class="control-label">
      <label class="required" for="<%=f.object.class.to_s.downcase%>_record_editors_attributes_0_name">
        <%# NOTE: Whenever you just copy the HTML generated by Simple Form it breaks internationalization %>
        <%= I18n.t('simple_form.required.html', default: '<abbr title="" data-original-title="required">*</abbr>').html_safe %>
        <%= I18n.t('sufia.work.collaborator.editor.name') %>
        <span class="help-inline"><%= I18n.t('sufia.work.collaborator.editor.help') %></span>
      </label>
    </span>
    <div class="controls">
      <% prefix = ActiveModel::Naming.singular_route_key(f.object.class) %>

      <script id="entry-template" type="text/x-handlebars-template">
        <li class="field-wrapper input-group">
          <input id="<%=prefix %>_record_editors_attributes_{{index}}_id" name="<%=prefix %>[record_editors_attributes][{{index}}][id]" type="hidden" value="" />
          <input class="input-xlarge autocomplete-users" id="<%=prefix %>_record_editors_attributes_{{index}}_name" name="<%=prefix %>[record_editors_attributes][{{index}}][name]" type="text" value="" />
          <span class="field-controls"><button class="btn btn-success add"><i class="icon-white icon-plus"></i><span>Add</span></button></span>
        </li>
      </script>
      <script id="existing-user-template" type="text/x-handlebars-template">
        <li class="field-wrapper input-group">
          <span class="linked-user">{{label}}</span>
          <input type="hidden" name="<%=prefix %>[record_editors_attributes][{{index}}][id]" value="{{value}}" data-attribute-key="id" data-info="not-persisted">
          <input type="hidden" name="<%=prefix %>[record_editors_attributes][{{index}}][_new]" value="true" data-attribute-key="_new" >
          <input type="hidden" name="<%=prefix %>[record_editors_attributes][{{index}}][name]" value="{{name}}" data-attribute-key="name" >
          <span class="field-controls"><button class="btn btn-danger remove"><i class="icon-white icon-minus"></i><span>Remove</span></button></span>
        </li>
      </script>
      <ul class="listing">

      <%= f.fields_for :record_editors do |editor| %>
        <li class="field-wrapper input-group">
          <%= editor.hidden_field :id %>
          <%= editor.hidden_field :_destroy, data: { "attribute-key" => "_destroy" } %>
          <% if editor.object.persisted? %>
            <span class="linked-user"><%=editor.object.name%></span>
          <% else %>
            <%= editor.text_field :name,
              class: 'input-xlarge autocomplete-users', 'data-url' => people_path, required: editor.index == 0  %>
          <% end %>

          <span class="field-controls"></span>
        </li>
      <% end %>

      </ul>
    </div>
  </div>
</fieldset>
